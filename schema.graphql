"""
The WhackRock Fund Registry
"""
type Registry @entity(immutable: false) {
  id: ID! # Registry contract address
  allowedTokens: [AllowedToken!]! @derivedFrom(field: "registry")
  funds: [Fund!]! @derivedFrom(field: "registry")
  fundCount: BigInt!
  createdAt: BigInt!
  updatedAt: BigInt!
}

"""
Tokens allowed in the registry's global allowlist
"""
type AllowedToken @entity(immutable: false) {
  id: ID! # Registry address + token address
  registry: Registry!
  token: Bytes! # Token address
  isActive: Boolean! # True if currently allowed, false if removed
  addedAt: BigInt!
  removedAt: BigInt
  addedAtBlock: BigInt!
  removedAtBlock: BigInt
}

"""
Individual WhackRock Fund
"""
type Fund @entity(immutable: false) {
  id: ID! # Fund contract address
  registry: Registry!
  fundId: BigInt! # Sequential ID from registry
  address: Bytes! # Fund contract address
  creator: Bytes! # Address that created the fund
  agent: Bytes! # Current agent managing the fund
  name: String! # ERC20 name
  symbol: String! # ERC20 symbol
  
  # Fund configuration
  agentAumFeeWallet: Bytes!
  agentAumFeeBps: BigInt!
  
  # Allowed tokens for this fund
  allowedTokens: [FundToken!]! @derivedFrom(field: "fund")
  
  # NAV tracking
  navSnapshots: [FundNAVSnapshot!]! @derivedFrom(field: "fund")
  currentNAVInUSDC: BigInt!
  lastNAVUpdate: BigInt!
  
  # ERC20 data
  totalSupply: BigInt!
  
  # Timestamps
  createdAt: BigInt!
  createdAtBlock: BigInt!
  updatedAt: BigInt!
}

"""
Tokens allowed in individual funds with their target weights
"""
type FundToken @entity(immutable: false) {
  id: ID! # Fund address + token address
  fund: Fund!
  token: Bytes! # Token address
  targetWeight: BigInt! # Target weight in basis points (0-10000)
  isActive: Boolean! # True if currently part of the fund
  addedAt: BigInt!
  addedAtBlock: BigInt!
  updatedAt: BigInt!
}

"""
Hourly snapshots of fund NAV in USDC
"""
type FundNAVSnapshot @entity(immutable: true) {
  id: ID! # Fund address + hour timestamp
  fund: Fund!
  navInUSDC: BigInt! # Total NAV in USDC at this hour
  totalSupply: BigInt! # Total share supply at this time
  navPerShare: BigDecimal! # NAV per share (navInUSDC / totalSupply)
  timestamp: BigInt! # Timestamp rounded to the hour
  blockNumber: BigInt! # Block number of the snapshot
  
  # Source information
  triggeredBy: String! # What triggered this snapshot (deposit, withdrawal, fee, manual)
  transactionHash: Bytes! # Transaction that triggered the snapshot
}

"""
Agent information and changes
"""
type Agent @entity(immutable: false) {
  id: ID! # Agent address
  address: Bytes! # Agent address
  activeFundCount: BigInt!
  totalFundCount: BigInt!
  firstActiveAt: BigInt!
  lastActiveAt: BigInt!
}

"""
Global statistics
"""
type GlobalStats @entity(immutable: false) {
  id: ID! # Always "1"
  totalFunds: BigInt!
  totalRegistryAllowedTokens: BigInt!
  totalValueLockedUSDC: BigInt! # Sum of all fund NAVs
  lastUpdated: BigInt!
} 